# 2-6 E2E CoS Test for PBI 2
[Back to task list](./tasks.md)

## Description
Create end-to-end tests that verify PBI 2's Conditions of Satisfaction: text editing, image replacement, undo/redo, dirty state, and save/reopen persistence. Use the same E2E framework and fixtures from PBI 1, adding editing-specific scenarios.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 18:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 10:35:00 | Status Change | Proposed | Agreed | User approved fast-track plan | User |
| 2026-02-19 10:40:00 | Status Change | Agreed | InProgress | Implementing E2E editing tests | AI_Agent |
| 2026-02-19 11:50:00 | Status Change | InProgress | Review | All 8 E2E scenarios pass (54s); full suite 15/15 pass (1.4m). Fixed boundingBox property names (.left/.top → .x/.y). | AI_Agent |

## Requirements
- **E2E scenarios:**
  1. Open `simple-text.pdf` → select text object → double-click → edit text → commit → page re-renders with new text.
  2. Open `embedded-images.pdf` → select image → replace with test JPEG → page re-renders with new image.
  3. Edit text → undo → text reverts; redo → edit reapplied.
  4. Edit text → dirty indicator shown → save → dirty indicator cleared.
  5. Edit text → attempt close → confirmation dialog appears.
  6. Edit text → save → close → reopen → edited text visible.
  7. Replace image with PNG (alpha) → save → reopen → transparency preserved.
  8. Open `cjk-text.pdf` → select CJK text → edit → save → reopen → CJK edits persist.
- **Fixtures:** Reuse PBI 1 fixtures; add `test/fixtures/replace-image.jpg` and `test/fixtures/replace-image.png` as replacement image inputs.
- **Offline:** Verify no network calls during editing and save.

## Implementation Plan
1. Add replacement image fixtures to `test/fixtures/`.
2. Implement E2E test scenarios in `test/e2e/editing.test.ts`.
3. Ensure tests clean up after themselves (restore original fixtures; delete temp saves).

## Test Plan
This task IS the test plan for PBI 2's editing CoS. All 8 scenarios above must pass.

## Verification
- All 8 E2E scenarios pass.
- Test run completes within 90 seconds.
- No network calls detected during test execution.

## Files Modified
- `test/e2e/editing.test.ts` — E2E editing test file (new)
- `test/fixtures/replace-image.jpg` — JPEG replacement image fixture (new)
- `test/fixtures/replace-image.png` — PNG replacement image fixture with alpha (new)
