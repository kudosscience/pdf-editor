# 2-2 Text edit primitives
[Back to task list](./tasks.md)

## Description
Implement `editTextObject` in the native PDFium addon and expose it through the TypeScript façade and IPC layer. This allows changing the text content of a selected text object, with optional font name and size parameters.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 18:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |
| 2026-02-19 10:00:00 | Status Change | Proposed | Agreed | Fast-tracked: full implementation already exists from PBI 1 scaffolding | User |
| 2026-02-19 10:00:00 | Status Change | Agreed | InProgress | Implementation verified against requirements | AI_Agent |
| 2026-02-19 10:01:00 | Status Change | InProgress | Review | All requirements met: native EditTextObject with FPDFText_SetText, façade with validation, IPC handler with cache invalidation, preload bridge | AI_Agent |

## Requirements
- Addon function: `editTextObject(handle, pageIndex, objectId, newText, fontName?, fontSize?)`.
  - Uses PDFium's `FPDFText_SetText` or equivalent to update glyph content.
  - If `fontName` provided, attempt to find/load font; error if unavailable.
  - If `fontSize` provided, update the text object's font size.
- IPC `pdf:edit-text` channel accepts `{ docId, pageIndex, objectId, newText, fontName?, fontSize? }` and returns `{ ok: true }`.
- Façade validates inputs: non-empty `newText`, valid `objectId` (from `listPageObjects`), font size > 0.
- Error handling: return clear error if object not found, font unavailable, or text cannot be set.
- After edit, the page must re-render to show updated text.

## Implementation Plan
1. Implement `editTextObject` in `native/pdfium/src/objects.cc` using PDFium edit API.
2. Add wrapper in `src/main/pdfium.ts` with validation.
3. Wire `pdf:edit-text` IPC handler in `src/main/ipc-handlers.ts`.
4. Add `editText()` to preload bridge in `src/preload/index.ts`.
5. Invalidate render cache for the affected page after edit.

## Test Plan
- **Basic edit:** Change text in `simple-text.pdf` → save → reopen → new text visible.
- **Font change:** Change font size → save → reopen → size differs from original.
- **Invalid font:** Request non-existent font → error returned; original text unchanged.
- **Invalid objectId:** Non-existent ID → error returned.
- **Persistence:** Edit → save → close → reopen → text change persists.

## Verification
- Text edits visible in re-rendered page immediately.
- Edits persist across save/reopen cycles.
- Errors are descriptive and do not corrupt the document.

## Files Modified
- `native/pdfium/src/objects.cc` — editTextObject implementation
- `src/main/pdfium.ts` — editTextObject wrapper with validation
- `src/main/ipc-handlers.ts` — pdf:edit-text handler
- `src/preload/index.ts` — pdf.editText() bridge method
- `src/shared/ipc-schema.ts` — EditTextPayload type
