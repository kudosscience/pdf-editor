# 2-1 Object discovery and hit-testing
[Back to task list](./tasks.md)

## Description
Expose `listPageObjects` from the PDFium addon through the IPC layer and implement hit-testing in the renderer so users can click on text and image objects to select them. Selected objects show a visual overlay with bounding box and handles.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2026-02-18 18:00:00 | Created | N/A | Proposed | Task file created | AI_Agent |

## Requirements
- Addon `listPageObjects` returns array of `{ id, type: 'text'|'image', left, top, right, bottom }` for a given page.
- IPC `pdf:list-objects` channel accepts `{ docId, pageIndex }` and returns the object array.
- Renderer hit-tests mouse click coordinates (accounting for zoom/pan offset) against object bounding boxes.
- Single-click selects an object; display blue outline overlay.
- Click on empty area deselects.
- Handle edge cases: overlapping objects (topmost wins), rotated pages (transform bboxes), CJK text objects.
- Expose selected object info in properties panel placeholder.

## Implementation Plan
1. Wire `pdf:list-objects` IPC handler in `src/main/ipc-handlers.ts`.
2. Add `listObjects()` method to preload bridge.
3. On page render complete, fetch object list and cache it.
4. Implement hit-test function: translate screen coords → PDF coords; check point-in-rect.
5. Draw selection overlay on a transparent canvas layer above the page canvas.
6. Show object type and bounds in properties panel.

## Test Plan
- **Object listing:** `listPageObjects` returns expected objects for `simple-text.pdf` and `embedded-images.pdf`.
- **Hit-test:** Click on known text object → selected; click on image → selected; click empty → deselected.
- **Zoom:** Hit-testing works correctly at 50%, 100%, and 200% zoom.
- **Edge case:** Rotated page objects have correct transformed bounds.

## Verification
- Objects selectable on all fixture PDFs.
- Selection overlay renders on correct position.
- Properties panel shows selected object info.

## Files Modified
- `src/main/ipc-handlers.ts` — Add pdf:list-objects handler
- `src/preload/index.ts` — Add pdf.listObjects() bridge method
- `src/renderer/app.ts` — Hit-testing logic, selection overlay rendering
- `src/renderer/styles.css` — Selection overlay styles
